[agent]
  interval = "10s"
  flush_interval = "10s"
  hostname = "telegraf"

# -------------------
# EVE.JSON (alertas e flows)
# -------------------
# [[inputs.tail]]
#   files = ["/var/log/suricata/eve.json"]
#   from_beginning = false
#   data_format = "json"
#   json_name_key = "event_type"
#   json_time_key = "timestamp"
#   json_time_format = "2006-01-02T15:04:05.999999-0700"
#   tag_keys = ["src_ip", "dest_ip", "proto"]

[[inputs.tail]]
  files = ["/var/log/suricata/eve.json"]
  from_beginning = false
  data_format = "json"
  json_name_key = "event_type"
  json_time_key = "timestamp"
  json_time_format = "2006-01-02T15:04:05.999999-0700"
  tag_keys = ["event_type"]

# (starlark processor and temporary test input removed)

# Contador de eventos por tipo
[[processors.enum]]
  [[processors.enum.mapping]]
    field = "event_type"
    dest = "suricata_event_type"
    default = 0
    [processors.enum.mapping.value_mappings]
      alert = 1
      flow = 2
      stats = 3

# Converter m√©tricas de stats (CPU, mem, throughput)
[[processors.converter]]
  [processors.converter.fields]
    integer = [
      "flow.bytes_toserver",
      "flow.bytes_toclient",
      "flow.pkts_toserver",
      "flow.pkts_toclient",
      "stats.capture.kernel_packets",
      "stats.decoder.pkts",
      "stats.decoder.bytes",
      "stats.flow.memuse",
      "stats.tcp.reassembly_memuse",
      "stats.detect.alert"
    ]

[[outputs.prometheus_client]]
  listen = ":9273"
  metric_version = 2

# Execute a small script that extracts the latest Suricata 'stats' event and emits an Influx line
[[inputs.exec]]
  commands = ["/etc/telegraf/scripts/suricata_stats_to_influx.sh"]
  timeout = "5s"
  data_format = "influx"
  interval = "10s"
